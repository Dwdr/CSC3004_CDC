<!DOCTYPE html>
<html>
  <body>
    <h1>Live streaming</h1>

    <div>
      <video id="videoElement" width="50%" autoplay></video>
    </div>

    <div id="movementStatus"></div>

    <script>
      var video = document.getElementById("videoElement");

      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices
          .getUserMedia({ video: true })
          .then(function (stream) {
            video.srcObject = stream;

            var canvas = document.createElement("canvas");
            var context = canvas.getContext("2d");

            function captureFrames() {
              context.drawImage(video, 0, 0, canvas.width, canvas.height);
              var imageData = context.getImageData(
                0,
                0,
                canvas.width,
                canvas.height
              );

              // Convert image data to base64 string
              var base64Image = canvas.toDataURL("image/png");
              sendImageToBackend(base64Image);

              requestAnimationFrame(captureFrames);
            }

            requestAnimationFrame(captureFrames);
          })
          .catch(function (error) {
            console.log("Error accessing camera: " + error);
          });
      }

      function sendImageToBackend(imageData) {
        // Send the image data to the backend using AJAX or fetch API
        // Replace the URL with the appropriate endpoint in your backend
        var endpointURL = "http://127.0.0.1:8000/process-image";
        fetch(endpointURL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ image: imageData }),
        })
          .then(function (response) {
            // Handle the response from the backend
            return response.json();
          })
          .then(function (data) {
            // Update the HTML content based on the response
            var movementStatus = document.getElementById("movementStatus");
            if (data.has_movement) {
              movementStatus.textContent = "Movement detected!";
            } else {
              movementStatus.textContent = "No movement detected.";
            }
          })
          .catch(function (error) {
            console.log("Error sending image to backend:", error);
          });
      }
    </script>
  </body>
</html>
